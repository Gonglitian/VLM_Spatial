# conf/train_qwen.yaml - Unsloth Vision LoRA å¾®è°ƒä¸»é…ç½®æ–‡ä»¶
# =============================================================================

# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚                          ğŸƒ è¿è¡Œç¯å¢ƒé…ç½®                               â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
run:
  cuda_visible_devices: "1"          # GPUè®¾å¤‡ID
  seed: 3407                         # å…¨å±€éšæœºç§å­ï¼Œç¡®ä¿å¯é‡ç°æ€§
  resume_from_checkpoint: null       # ä»æ£€æŸ¥ç‚¹æ¢å¤è®­ç»ƒçš„è·¯å¾„

# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚                          ğŸ¤– æ¨¡å‹é…ç½®                                   â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
model:
  name: unsloth/Qwen2.5-VL-3B-Instruct-bnb-4bit  # æ¨¡å‹åç§°æˆ–è·¯å¾„
  load_in_4bit: true              # ä½¿ç”¨4bit NF4åŠ è½½åŸºç¡€æƒé‡
  torch_dtype: "auto"             # æ•°æ®ç±»å‹: "auto"|"bf16"|"fp16"|"fp32"
  # todo ä¸‹é¢5ä¸ªæœªéªŒè¯
  gradient_ckpt: "unsloth"        # å¯ç”¨Unslothçš„æ¿€æ´»æ£€æŸ¥ç‚¹
  trust_remote_code: true         # å…è®¸è‡ªå®šä¹‰Qwenä»£ç 
  max_seq_length: 2048             # åºåˆ—é•¿åº¦ç¡¬é™åˆ¶
  device_map: "auto"              # è®¾å¤‡æ˜ å°„: "auto"|"sequential"|æ˜¾å¼å­—å…¸
  rope_scaling: null              # RoPEç¼©æ”¾é…ç½®ï¼Œå¦‚ {"type":"linear","factor":2}

# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚                          ğŸ¯ LoRAé…ç½®                                  â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
lora:
  r: 64                           # LoRAçŸ©é˜µçš„ç§©
  alpha: 64                       # ç¼©æ”¾å› å­ï¼Œé€šå¸¸ç­‰äºr
  dropout: 0.05                   # LoRAé€‚é…å™¨å†…çš„dropout
  bias: "none"                    # åç½®è®¾ç½®: "none"|"lora_only"|"all"
  finetune_vision_layers: true    # åœ¨è§†è§‰å¡”ä¸Šåº”ç”¨LoRA
  finetune_language_layers: true  # åœ¨è¯­è¨€å±‚ä¸Šåº”ç”¨LoRA
  finetune_attention_modules: true # åœ¨Q,K,V,Oçº¿æ€§å±‚åº”ç”¨LoRA
  finetune_mlp_modules: true      # åœ¨FFNçº¿æ€§å±‚åº”ç”¨LoRA
  use_rslora: false               # ä½¿ç”¨Rank Stabilized LoRA
  loftq_config: null              # LoftQé…ç½®å­—å…¸ï¼ˆå¯é€‰ï¼‰
  target_modules: "all-linear"    # ç›®æ ‡æ¨¡å—æˆ–æ­£åˆ™è¡¨è¾¾å¼åˆ—è¡¨
  enable_gradient_checkpointing: false  # é¢å¤–çš„LoRAçº§æ£€æŸ¥ç‚¹

# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚                          ğŸ“Š æ•°æ®é…ç½®                                   â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
data:
  dataset_name: "unsloth/LaTeX_OCR"   # HFæ•°æ®é›†è·¯å¾„æˆ–æœ¬åœ°æ–‡ä»¶
  split: "train"                      # æ•°æ®é›†åˆ†å‰²åç§°
  max_samples: null                   # æœ€å¤§æ ·æœ¬æ•°ï¼Œnullè¡¨ç¤ºä½¿ç”¨å…¨éƒ¨æ•°æ®
  num_proc: 1                          # æ•°æ®å¤„ç†è¿›ç¨‹æ•°ï¼ˆå›ºå®šå•çº¿ç¨‹ï¼‰
  instruction: "Write the LaTeX representation for this image."  # æŒ‡ä»¤æç¤º
  shuffle: true                        # æ˜¯å¦æ‰“ä¹±æ•°æ®
  streaming: false                    # å¯ç”¨HFæµå¼æ¨¡å¼
  val_split_ratio: 0.0                # éªŒè¯é›†æ¯”ä¾‹ï¼Œ0è¡¨ç¤ºæ— éªŒè¯é›†

# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚                          ğŸ‹ï¸ è®­ç»ƒé…ç½®                                   â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
train:
  # åŸºç¡€è®­ç»ƒå‚æ•°
  batch_size: 512                       # æ¯GPUçš„mini-batchå¤§å°
  grad_accum: 1                       # æ¢¯åº¦ç´¯ç§¯æ­¥æ•°
  num_epochs: 2                       # è®­ç»ƒè½®æ•°
  max_steps: null                     # æœ€å¤§æ­¥æ•°ï¼Œè¦†ç›–num_epochs
  
  # ä¼˜åŒ–å™¨å’Œå­¦ä¹ ç‡
  learning_rate: 2.0e-4               # å­¦ä¹ ç‡
  lr_scheduler_type: "linear"         # å­¦ä¹ ç‡è°ƒåº¦å™¨: linear|cosine|constant
  warmup_steps: 5                    # å­¦ä¹ ç‡é¢„çƒ­æ­¥æ•°
  weight_decay: 0.01                  # æƒé‡è¡°å‡
  optim: "paged_adamw_8bit"           # ä¼˜åŒ–å™¨ç±»å‹
  gradient_clipping: 1.0              # æ¢¯åº¦è£å‰ª
  
  # ç²¾åº¦å’Œå†…å­˜
  max_seq_length: 2048                # è®­ç»ƒåºåˆ—é•¿åº¦
  fp16: false                         # FP16æ··åˆç²¾åº¦è®­ç»ƒ
  bf16: true                          # BF16æ··åˆç²¾åº¦è®­ç»ƒ
  gradient_checkpointing: false       # HFçº§æ¢¯åº¦æ£€æŸ¥ç‚¹
  
  # æ—¥å¿—å’Œä¿å­˜
  logging_steps: 1                   # æ¯Næ­¥è®°å½•æ—¥å¿—
  save_strategy: "steps"              # ä¿å­˜ç­–ç•¥: "steps"|"epoch"
  save_steps: 20                     # ä¿å­˜é¢‘ç‡
  output_dir: "outputs"               # æ£€æŸ¥ç‚¹ä¿å­˜ç›®å½•
  
  # è¯„ä¼°é…ç½®
  evaluation_strategy: "no"           # è¯„ä¼°ç­–ç•¥: "steps"|"epoch"|"no"
  eval_steps: 500                     # è¯„ä¼°é¢‘ç‡
  
  # ç³»ç»Ÿé…ç½®
  dataloader_num_workers: 32           # æ•°æ®åŠ è½½å™¨å·¥ä½œè¿›ç¨‹æ•°
  deepspeed_config: null              # DeepSpeed ZeRO-3é…ç½®æ–‡ä»¶è·¯å¾„
  report_to: ["wandb"]                # å®éªŒè·Ÿè¸ª: "none"|"wandb"|"tensorboard"
  disable_tqdm: false                 # ç¦ç”¨è¿›åº¦æ¡

# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚                          ğŸ“ˆ W&Bé…ç½®                                    â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
wandb:
  project: "latex_ocr"                               # W&Bé¡¹ç›®åç§°
  entity: null                        # W&Bå›¢é˜Ÿåç§°
  run_name: "qwen2.5-vl-3b-instruct-lora"            # å®éªŒè¿è¡Œåç§°
  tags: ["qwen", "vision", "lora"]  # å®éªŒæ ‡ç­¾
  notes: null                         # å®éªŒå¤‡æ³¨
  # log_model: true                     # ä¸Šä¼ æœ€ä½³æ£€æŸ¥ç‚¹ä½œä¸ºartifact
